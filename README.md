# Интеграция ПетроЭлектроСбыт для Home Assistant

[![hacs_badge](https://img.shields.io/badge/HACS-Custom-41BDF5.svg)](https://github.com/hacs/integration)

Интеграция позволяет получить доступ к информации о переданных показателей счетчиков [ПетроЭлектроСбыт](https://ikus.pesc.ru/), а так же предоставляет сервис обновления показаний.

## Установка
* Откройте HACS->Интеграции->(меню "три точки")->Пользовательские репозитории
* Добавьте пользовательский репозиторий `dentra/ha-pesc` в поле репозиторий, в поле Категория выберете `Интеграция`

## Настройка
* Откройте Конфигурация->Устройсва и службы->Добавить интеграцию
* В поисковой строке введите `pesc` и выберети интеграцию `Pesc`
* Введите немер телефона и пароль

## Использование

В зависимости от данных лицевого счта, будут созданы соотвествующие сенсоры.

По-умолчанию, обновление данных происходит раз в 12 часов, Вы всегда можете изменить этот парамтр в настройках службы.

## Изменение значений

Используйте визульный редактор и службу `pesc.update_value`

Или воспользуйтесь примером ниже:
```yaml
service: pesc.update_value
target:
  entity_id: sensor.pesc_98765432_1
data:
  value: 12345
```

## Получение стоимости тарифа

Для тарифа типа "Двухтарифный", можно создать сенсоры с ценой для подключения к панели "Энергия".
Для других типов тарифа мне нужны доп данные, создавайте задачу, добавлю.

Пример:
```yaml
sensor:
  - platform: template
    sensors:
      energy_rate:
        unique_id: energy_rate
        friendly_name: "Energy Rate"
        icon_template: mdi:cash
        unit_of_measurement: "RUB/kWh"
        value_template: '{{ state_attr("sensor.pesc_98765432_1", "tariff_rate")}}'
```

Начиная с версии от 22.05.2023 сенсоры со стоимостью тарифа можно добавить автоматически,
включив соответсвующую опцию в настройках службы.